<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Cycling+Running Dashboard</title>

  <link rel="icon"          href="../favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />

  <!-- Bootstrap  -->
  <link href="./css/components/bootstrap/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="./css/style.dashboard.css" > 
  <link rel="stylesheet" href="./js/components/leaflet/leaflet.css" />

  <style>
  
body { 
  padding-top: 0px; 
}

div { border: 0px solid #ff6666; }
svg { border: 0px solid #6666ff; }

div.zero-pad-left {padding-left: 0px;}

a         { color: #4682b4; text-decoration: none; }
a:hover   { color: #b0c4de; text-decoration: none; }
a:visited { color: #4682b4; text-decoration: none; }

.navbar-static-top { border: 0; margin: 0; }
/*.navbar-inverse { background-color: #f8f8f8;}*/
.navbar-inverse .navbar-brand { color: #bbb; font-weight: bold; }
.navbar-inverse .navbar-nav > li > a { color: #ffd040; }

.container-fluid { padding-right: 35px; }

.table { margin-bottom: 0px; }

.table > tbody > tr > td { 
  padding: 0px;
  padding-top: 8px;
  padding-bottom: 8px; 
  line-height: 1; 
}

.form-control-history {
  height: auto; 
  padding: 5px;  
  padding-right: 0px;
  font-size: 12px;
  border: 0px;
  border-radius: 0px;
  box-shadow: none;
  background-color: #fff;
  }

#select-conv-window { width: 30px; }

/*eliminate blue halo around select elements*/
select:focus, select:hover, input:focus { outline: 1px solid #ccc !important; box-shadow: none !important;  }

#div-history { border: 1px solid #ccc; }

#div-history-controls { padding-top: 10px;
                        padding-left: 25px;
                        padding-right: 25px;
                      }

.label-history{ font-size: 12px; padding-left: 10px;}

.month-label {  font-size: 8px; }
.calendar-cell { stroke: #aaa; shape-rendering: crispEdges;}

#history-x-axis line { stroke: #aaa; opacity: 0.7; }
#history-x-axis path { stroke-width: 0; }

#history-y-axis-left line { stroke: #aaa; opacity: 0.7; }
#history-y-axis-left path { stroke-width: 0; }
#history-y-axis-right line { stroke: #aaa; opacity: 0.7; }
#history-y-axis-right path { stroke-width: 1; }

.axis { shape-rendering: crispEdges; }


.field-name {
  color: #666;
  font-size: 14px;
}
.field-value {
  font-size: 16px;
  font-weight: bold;
}
.field-unit {
  font-size: 14px;
}
.datetime {
  font-size: 12px;
  padding-right: 5px;
}



  </style>
</head>

<body>

  <nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid">
    
      <div class="navbar-header">
        <a class="navbar-brand" href="#">(cycling + running).Dashboard()</a>
      </div>

    <ul class="nav navbar-nav navbar-right">
      <li><a href="about.html">About</a></li>
      <li><a href="http://kchev.org">kchev.org</a></li>
    </ul>

    </div>
  </nav>

  <div class="container-fluid">

    <!-- top row: Calendar   -->
    <div class="row">
      <div class="col-sm-12">  
        <div id="div-calendar" style="padding-top:10px;"></div>
      </div>
    </div>

    <!-- left column: activity info and map -->
    <div class="row">
      <div class="col-sm-3">  
        <div id="div-datetime" style="padding-top: 0px;"></div>
        <div class="table-responsive" id="div-info"></div>
        <div id="div-map" style="height: 200px;"></div>
      </div>

    <!-- right column: history plot and controls -->
    <div class="col-sm-9 zero-pad-left"><div id="div-history">

      <!-- history plot controls -->
      <form class="form-inline">
        <div class="form-group" id="div-history-controls">
          <label for="select-parameter" class="label-history">Parameter: </label>
          <select class="form-control form-control-history" id="select-parameter"></select>
          <label for="select-conv-type" class="label-history">Convolution type: </label>
          <select class="form-control form-control-history" id="select-conv-type"></select>
          <label for="conv-window-size" class="label-history">Window size: </label>
          <input class="form-control form-control-history" id="select-conv-window"></input>
        </div>
      </form>

      <!-- history plot -->
      <div id="div-history-plot"></div>

    </div></div> <!-- end right column -->
  </div>   <!-- end row -->

  <script src="./js/components/d3.v4/d3.min.js">    </script>
  <script src="./js/components/leaflet/leaflet.js"> </script>

  <script>

  var rideData, previewMap, previewPolyline;
  
  d3.csv("metadata", function(e, csvData) { 
    window.csvData = csvData; 
    initDashboard();
  });
  
  window.onresize = windowResized;
  window.setTimeout(windowResized, 500);

  var formatDateToKey = d3.timeFormat("%Y-%m-%d");

    function drawHistory() {

      var csvData = window.csvData;

      var params = loadProps().rideParametersByKey;

      csvDict = listOfDictsToDictOfLists(csvData);

      var aspectRatio = 2;
      var divSize = {'w': parseInt(d3.select("#div-history-plot").style('width')),
                     'h': parseInt(d3.select("#div-history-plot").style('width'))/aspectRatio};
      
      var divPad = 0; 
      var plotPad = {'h': 20, 'w': 50};
      var plotSize = {'h': divSize.h - divPad, 'w': divSize.w - divPad};

      var date_i = d3.timeDay.offset(d3.min(csvDict.timestamp), 0);
      var date_f = d3.timeDay.offset(d3.max(csvDict.timestamp), 0);

      selectionParam      = d3.select("#select-parameter").on("change", doPlot );
      selectionConvType   = d3.select("#select-conv-type").on("change", doPlot );
      selectionConvWindow = d3.select("#select-conv-window").on("change", doPlot );

      selectableParams = loadProps().rideParameters.filter( function(row) { return row.range.length!=0; });
      
      selectionParam.selectAll("option")
                    .data(selectableParams)
                    .enter().append("option")
                    .attr("value", function(d) { return d.key; })
                    .text(function(d) { return d.label; });

      selectionConvType.selectAll("option")
                       .data(['None', 'Window', 'Exponential'])
                       .enter().append("option")
                       .attr("value", function (d) { return d; })
                       .text(function(d) { return d; });

      if (!('historyPlotParameter' in window))  { window.historyPlotParameter = "total_distance"; }

      if (!('historyPlotConv' in window)) { window.historyPlotConvType = "Exponential"; }

      if (!('historyPlotConvWindow' in window)) { window.historyPlotConvWindow = "30"; }

      selectionParam.property("value", window.historyPlotParameter);
      selectionConvType.property("value", window.historyPlotConvType);
      selectionConvWindow.property("value", window.historyPlotConvWindow);

      d3.select("#div-history-plot").selectAll("svg").remove();

      svg = d3.select("#div-history-plot")
              .append("svg")
              .attr("width", plotSize.w)
              .attr("height", plotSize.h)
              .append("g")
              .attr("transform", "translate(" + divPad + "," + divPad + ")");

      XScale = d3.scaleTime()
                 .range([plotPad.w, plotSize.w - plotPad.w])
                 .domain([date_i, date_f]);

      XAxis = d3.axisBottom(XScale)
                .ticks(d3.timeMonth.every(1))
                .tickFormat("")
                .tickSize(0,0,0);

      XGrid = d3.axisBottom(XScale)
                .ticks(d3.timeMonth.every(1))
                .tickFormat(d3.timeFormat("%b %y"))
                .tickSize(-(plotSize.h - 2*plotPad.h),0,0);

      YScaleParam = d3.scaleLinear()
                      .range([ plotSize.h - plotPad.h, plotPad.h])
                      .domain(params[window.historyPlotParameter].range);

      YScaleConv = d3.scaleLinear()
                     .range([ plotSize.h - plotPad.h, plotPad.h]);

      lineParam = d3.line()
                    .x(function(d) {return XScale(d.timestamp); })
                    .y(function(d) {return YScale(d[window.historyPlotParameter]); })
                    .curve(d3.curveBasis);

      lineConv = d3.line()
                   .x(function(d) {return XScale(d.days); })
                   .y(function(d) {return YScaleConv(d.conv/d.count); })
                   .curve(d3.curveLinear);

      // svg.append("g")
      //    .attr("class", "axis")
      //    .attr("id", "history-x-axis")
      //    .attr("transform", "translate(0," + (plotSize.h - plotPad.h ) + ")")
      //    .call(XAxis);

      svg.append("g")
         .attr("class", "axis")
         .attr("id", "history-x-axis")
         .attr("transform", "translate(0," + (plotSize.h - plotPad.h ) + ")")
         .call(XGrid);

      svg.append("g")
         .attr("class", "axis")
         .attr("id", "history-y-axis-left")
         .attr("transform", "translate(" + (plotPad.w - 10) + ",0)");

      svg.append("g")
         .attr("class", "axis")
         .attr("id", "history-y-axis-right")
         .attr("transform", "translate(" + (plotSize.w - plotPad.w) + ",0)");

      svg.append("path")
         .attr("class", "line-plot-path")
         .attr("id", "param-path")
         .attr("stroke", "tomato")
         .attr("stroke-width", 1)
         .attr("fill", "none");

      svg.append("path")
         .attr("class", "line-plot-path")
         .attr("id", "conv-path")
         .attr("stroke", "steelblue")
         .attr("stroke-width", 1)
         .attr("fill", "none");

      svg.selectAll(".history-dot")
         .data(csvData)
         .enter().append("circle")
         .attr("class", "history-dot")
         .attr("r", 2)
         .attr("cx", function(d) { return XScale(d.timestamp); })
         .attr("cy", function(d) { return YScaleParam(d[window.historyPlotParameter]); })
         .style("fill", "tomato");

      doPlot();

      function doPlot() { 

        window.historyPlotConvWindow = selectionConvWindow.property("value");
        window.historyPlotParameter  = selectionParam.property("value");
        window.historyPlotConvType   = selectionConvType.property("value");

        if (selectionConvType.property("value")!="None") {
          convData = calcConvolution(
            window.historyPlotConvType, 
            window.historyPlotConvWindow*24*3600000, 
            window.historyPlotParameter);
          YScaleConv.domain()
        } else {
          convData = [];
        }

        YScaleParam.domain(params[window.historyPlotParameter].range);
        YScaleConv.domain([ YScaleParam.domain()[0], d3.max(convData, function(d) { return d.conv/d.count; }) ]);

        var tickStep = params[window.historyPlotParameter].step;

        YAxisLeft = d3.axisLeft(YScaleParam)
                     .tickValues(d3.range(tickStep, YScaleParam.domain()[1], tickStep))
                     .tickSize((-plotSize.w + plotPad.w)*0, 0, 0);

        YAxisRight = d3.axisRight(YScaleConv);

        if (window.historyPlotParameter == 'total_time_sec') {
          YAxisLeft.tickFormat( function (sec) { return Math.floor(sec/3600) + "h"; });
          YAxisRight.tickFormat( function (sec) { return Math.floor(sec/3600) + "h"; });
        }


        svg.select("#history-y-axis-left").transition().duration(500).call(YAxisLeft);
        svg.select("#history-y-axis-right").transition().duration(500).call(YAxisRight);

        lineParam.y(function(d) {return YScaleParam(d[window.historyPlotParameter]); });

        svg.select("#param-path").transition().duration(500)
        .attr("d", function(d) { return lineParam(csvData); });

        svg.select("#conv-path").transition().duration(500)
        .attr("d", function(d) { return lineConv(convData); });

        svg.selectAll(".history-dot").transition().duration(500)
        .attr("cy", function(d) { return YScaleParam(d[window.historyPlotParameter]); });

        // remove the first y axis tick 
        d3.selectAll("#history-y-axis-left g").each( function() { 
          if (d3.select(this).select("text").text()=="0") {
            d3.select(this).attr("visibility", "hidden");
          }
        });

       }
    }


    function drawCalendar() {

      var monthSpacer = 2;
      var pad = 0;
      var label_offset = 15;

      var divWidth = parseInt(d3.select("#div-calendar").style('width'));

      calWidth = divWidth - 2*pad;

      var cellSize  = (calWidth - 11*monthSpacer)/7/12;
      var calHeight = cellSize * 6 + label_offset;   
      
      // for now, make the calendar span 2016
      days   = d3.timeDays(new Date(2016,0,1), new Date(2017,0,1));
      months = d3.timeMonths(new Date(2016,0,1), new Date(2017,0,1));

      d3.select("#div-calendar").selectAll("svg").remove();

      svg = d3.select("#div-calendar")
              .append("svg")
              .attr("width", calWidth + 2*pad)
              .attr("height", calHeight + 2*pad)
              .append("g")
              .attr("transform", "translate(" + pad + "," + pad + ")");

      svg.selectAll(".month-label")
              .data(months)
              .enter()
              .append("text")
              .attr("class", "month-label")
              .style("text-anchor", "middle")
              .text(function(d) { return d3.timeFormat("%B")(d); })
              .attr("transform", function(d) { 
                return "translate(" + (d.getMonth()*(2+cellSize*7) + cellSize*7/2) + "," + label_offset/2 + ")"; 
              });

      rects = svg.selectAll(".calendar-cell")
                 .data(days)
                 .enter()
                 .append("rect")
                 .attr("class", "calendar-cell")
                 .attr("width", cellSize)
                 .attr("height", cellSize)
                 .attr("x", function(d) { return calcCalendarCellPosition(d).x; })
                 .attr("y", function(d) { return calcCalendarCellPosition(d).y + label_offset; });

      function calcCalendarCellPosition(date) {

        pos = {};

        y = date.getFullYear();
        m = date.getMonth();

        monthStartDate = new Date(y, m, 1);

        // we want Monday to be column 0, but .getDay() sets 0 at Sunday
        monthStart_DOW = monthStartDate.getDay() - 1 == -1 ? 6 : monthStartDate.getDay() - 1;

        d_DOW = date.getDay()-1 == -1 ? 6 : date.getDay()-1;
        offset = monthStart_DOW > 0 ? 7 - monthStart_DOW : 0;

         // this is the column - offset by prior months and spacing between months
        pos.x = cellSize*(d_DOW + m * 7) + monthSpacer*m;

        // this is the calendar row
        pos.y = cellSize*Math.floor( (date.getDate() - 1 + monthStart_DOW)/7 );

        return pos;
      }
    }

    function loadTable(activity_info) {

      params = loadProps().rideParametersByKey;

      d3.select("#div-info").select("table").remove();
      d3.select("#div-datetime").selectAll("span").remove();

      d3.select("#div-datetime").append("span").attr("class", "datetime").text(params.start_date.format(activity_info['start_date']));
      d3.select("#div-datetime").append("span").attr("class", "datetime").text(params.start_time.format(activity_info['start_time']));

      tbody = d3.select("#div-info").append("table").attr("class", "table").append("tbody");


      // these are a list of parameter keys in order of appearance in the table
      table_fields = [
            ['total_distance',   'total_time'],
            ['elevation_gain',   'total_work'],
            ['vert_per_mile',    'average_speed'],
            ['average_power',    'normalized_power'],
            ['intensity_factor', 'training_stress_score', ]];

      tr = tbody.selectAll("tr").data(table_fields).enter().append("tr");
      td = tr.selectAll("td").data(function(d) { return d; }).enter().append("td");

      td.append("span").attr("class", "field-value").text(function(d) { return params[d].format(activity_info[params[d].key]); });
      td.append("span").attr("class", "field-unit").text(function(d) { return '' + params[d].units; });
      td.append("br");
      td.append("span").attr("class", "field-name").text(function(d) { return params[d].label; });
    }


    function loadCalendar() {

      csvData = window.csvData;
      csvDict = listOfDictsToDictOfLists(csvData);

      cellColorField = 'total_distance';
      cellColorFieldEstMax = 50;
      cellColorFieldEstMin = 15;
      var colorMin = '#1e90ff'; // pale blue
      var colorMax = '#ff6347'; // orange
      

      colorMin = '#33ff66'; // greenish
      colorMax = '#ff3300'; // orange
      colorMin = '#0066ff'; // blue
      colorMax = '#cc33cc'; // pink


      tmpColor = d3.scaleLinear().range([colorMin, colorMax]).domain([0,1]);

      cellColor = d3.scaleLinear()
                 .range([colorMin, tmpColor(.1), tmpColor(.9), colorMax])
                 .domain([d3.min(csvDict[cellColorField]), cellColorFieldEstMin, cellColorFieldEstMax, d3.max(csvDict[cellColorField])]);

      rideData = d3.nest()
               .key(function(d) { return d.start_date; })
               .rollup(function(d) { return d[0]; })
               .object(csvData);

      rects.attr("fill", "#eee");
      
      rects.filter( function(date) { return formatDateToKey(date) in rideData; })
           .attr("fill", function(date) { 
              var rawColor = cellColor(rideData[formatDateToKey(date)][cellColorField]);
              return lightenColor(d3.color(rawColor), .5).toString(); 
            })
           .attr("opacity", 1)
           .attr("title", function(date) { return rideData[formatDateToKey(date)].total_distance; })
           .on("dblclick", openActivity)
           .on("click", previewActivity);

    }

    function initMap() {
      
      map = L.map('div-map');

      L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 18}).addTo(map);

      map.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text

      var berkeley = new L.LatLng(37.86, -122.25); // geographical point (longitude and latitude)
      map.setView(berkeley, 13);

      var lineOptions = {
        color: 'red',
        weight: 3,
        opacity: 0.7
      };

      polyline = new L.Polyline([], lineOptions);
      map.addLayer(polyline);      

    }

    function loadMap(activity_info) {

      var ridePoints = [];

      d3.json('getActivityData.php?type=preview&id=' + activity_info.activity_id, function(err, data) {
      
        for (i = 0; i < data.length; i+=1) {
          ridePoints.push( [+data[i].lon, +data[i].lat] );
        }        
    
        polyline.setLatLngs(ridePoints);

        map.fitBounds(polyline.getBounds());

      });

    }

    function previewActivity(date) {

      var activity_info = rideData[formatDateToKey(date)];
      loadTable(activity_info);
      loadMap(activity_info);      
    }


    function openActivity(date) {
      activity_id = rideData[formatDateToKey(date)].activity_id;
      window.location.assign("http://127.0.0.1/cycling-app-client/getdata.php?id=" + activity_id, '_blank');
    }


    function initDashboard() {

      processCSVData();

      drawCalendar();
      loadCalendar();
      drawHistory();
      initMap();

    }

    function windowResized() {
      drawCalendar();
      loadCalendar();
      drawHistory();
    }

    function processCSVData() {

      CYCLIST_FTP_ESTIMATE = 275

      window.csvData.map( function(row) { 

        row.timestamp = d3.timeParse("%Y-%m-%d %H:%M:%S")(row.start_date + ' ' + row.start_time);

        row.vert_per_mile = 2*row.elevation_gain / row.total_distance;

        var total_time_as_date = d3.timeParse("%H:%M:%S")(row.total_time);
        row.total_time_sec = total_time_as_date.getHours()*60*60 + total_time_as_date.getMinutes()*60 + total_time_as_date.getSeconds();

        row.intensity_factor      = row.normalized_power / CYCLIST_FTP_ESTIMATE
        row.training_stress_score = 100 * (row.total_time_sec/3600.) * row.intensity_factor**2 


        return row;

      });

      var csvData = window.csvData;

      // time diffs in hours
      csvData[0].dt = 0;
      for (i = 1; i < csvData.length; i = i + 1) {
        csvData[i].dt = (csvData[i].timestamp - csvData[i-1].timestamp) / 3600000 / 24;
      }

      window.csvData = csvData;

    }

    function calcConvolution(convType, windowSize, param) {

      var csvData = window.csvData;

      if (convType == 'Window') { calcConvWeight = convWeightWindow; }
      if (convType == 'Exponential') {calcConvWeight = convWeightExp; }

      var windowSizeInDays = Math.ceil(windowSize / (3600000 * 24));

      days = d3.timeDay.range(csvData[0].timestamp, csvData[csvData.length-1].timestamp);

      conv  = Array(days.length).fill(0);
      count = Array(days.length).fill(0);

      for (i = 0; i < csvData.length; i=i+1) {
        for (j = windowSizeInDays+1; j < days.length; j=j+1) {

          dt = days[j] - csvData[i].timestamp;

          convWeight = calcConvWeight(dt, windowSize);

          if (convWeight > 0) { count[j]++; }

          conv[j] = conv[j] + convWeight * csvData[i][param];

        }
      }

      convData = [];
      for (j = 0; j < days.length; j=j+1) {
        convData.push( {days: days[j], conv: conv[j], count: count[j] > 0 ? count[j] : 9999,} );
      }

      return convData;

    }

    function convWeightWindow(dt, windowSize) {

      neg_one_day = 86400000;

      dt = (dt < neg_one_day) ? windowSize : dt;

      return (dt < windowSize) ? 1 : 0;

    }


    function convWeightExp(dt, windowSize) {
      neg_one_day = 86400000;

      dt = (dt < neg_one_day) ? windowSize : dt;

      return (dt < windowSize) ? Math.exp(-dt / windowSize) : 0;

    }




    function listOfDictsToDictOfLists(list) {

      dict = {};
      keys = Object.keys(list[0]);

      for (ind in keys) {
        key = keys[ind];
        dict[key] = [];
        for (i = 0; i < list.length; i++) {
          dict[key][i] = list[i][key];
        }
      }
      return dict;
    }

    function lightenColor(color, alpha){
      // simulates opacity of alpha on white background

      color = d3.color(color);

      ['r', 'g', 'b'].map( function(c) {
        color[c] = color[c] + (1-alpha)*255;
        color[c] = color[c] > 255 ? 255 : color[c];
      });

      return color;
    }


    function loadProps() {

      props = {};

      f0 = d3.format('.0f')
      f1 = d3.format('.1f')
      f2 = d3.format('.2f')

      f_id = function (_) { return _; }

      fdate = function (dateString) { return d3.timeFormat("%B %d, %Y")(d3.timeParse("%Y-%m-%d")(dateString)); }
     
      // the timestamps from FIT files are 7 hours ahead of PST, so this ugly hack changes the time to PST
      ftime = function (timeString) { 
                  d = d3.timeParse("%H:%M:%S")(timeString);
                  return d3.timeFormat("%I:%M%p")(new Date(d.getTime() - 60000*60*7)); }

      var rideParameters = [
        {
          key: 'start_date', 
          label: 'Date', 
          units: '', 
          format: fdate, 
          range: []},
        {
          key: 'start_time', 
          label: 'Time',
          units: '', 
          format: ftime, 
          range: []},
        {
          key: 'total_time', 
          label: 'Duration',
          units: '', 
          format: f_id, 
          range: []},
        {
          key: 'total_time_sec', 
          label: 'Duration',
          units: '',
          format: f_id, 
          range: [0, 6*3600],
          step: 3600},
        {
          key: 'total_distance', 
          label: 'Distance', 
          units: 'mi', 
          format: f1, 
          range: [0,100],
          step: 20},

        {
          key: 'average_speed', 
          label: 'Speed', 
          units: 'mph', 
          format: f2,
          range: [0,20],
          step: 5},
        {
          key: 'elevation_gain', 
          label: 'Vert', 
          units: 'ft', 
          format: f0, 
          range: [0, 10000],
          step: 2000},
        {
          key: 'total_work', 
          label: 'Work', 
          units: 'kJ', 
          format: f0,
          range: [0, 4000],
          step: 1000},
        {
          key: 'average_power', 
          label: 'AP', 
          units: 'W', 
          format: f0, 
          range: [0,300],
          step: 50},
        {
          key: 'normalized_power', 
          label: 'NP', 
          units: 'W', 
          format: f0, 
          range: [0,300],
          step: 50},
        {
          key: 'intensity_factor', 
          label: 'IF', 
          units: '', 
          format: f2, 
          range: [0, 1],
          step: .2},
        {
          key: 'training_stress_score', 
          label: 'TSS', 
          units: '', 
          format: f1, 
          range: [0, 300],
          step: 50},
        {
          key: 'vert_per_mile', 
          label:'Slope', 
          units:'ft/mi', 
          format: f0, 
          range: [0, 600],
          step: 100},
      ];

      props.rideParameters = rideParameters;

      props.rideParametersByKey = d3.nest().key(function(d) { return d.key; }).rollup(function(d) { return d[0]; }).object(rideParameters);


      return props;
    }


    
  </script>


</body>
</html>


